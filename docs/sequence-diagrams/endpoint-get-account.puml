@startuml get-account-sequence
footer Simple Banking API - Hexagonal Architecture
title <size:20>GET /api/v1/accounts/:accountId - Get Account</size>

autonumber

actor Client

box Simple Banking API #lightblue
    participant "GetAccountHandler" as Handler
    participant "GetAccountProcessor" as Processor
    participant "AccountRepository" as Repo
    database SQLite
end box

Client -> Handler: [GET] /api/v1/accounts/{id}

activate Handler

    Handler -> Handler: Extract accountId from URL
    note right: chi.URLParam(r, "accountId")
    
    Handler -> Handler: Parse accountId to int64
    opt #LightPink Invalid format
        Client <-- Handler: Http 400: Invalid account ID format
    end

    Handler -> Handler: Validate accountId > 0
    opt #LightPink Invalid ID
        Client <-- Handler: Http 400: Account ID must be positive
    end

    Handler -> Processor: Process(GetAccountRequest)
    activate Processor

        Processor -> Repo: FindByID(accountId)
        activate Repo
            Repo -> SQLite: SELECT * FROM accounts\nWHERE id = ?
            
            opt #LightSalmon Database error
                Processor <-- Repo: Database Error
                Handler <-- Processor: Error 500
                Client <-- Handler: Http 500: Internal server error
            end
            
            opt #LightPink Account not found
                Processor <-- Repo: nil (not found)
                Handler <-- Processor: Error: not found
                Client <-- Handler: Http 404: Account not found
            end
            
            Processor <-- Repo: Account entity
        deactivate Repo

        Handler <-- Processor: GetAccountResponse
    deactivate Processor

    Handler -> Handler: Encode JSON response

    Client <-- Handler: Http 200: Account details

deactivate Handler

note over Client
    Success Response (200):
    {
        "account_id": 1,
        "document_number": "12345678900",
        "created_at": "2025-11-21T10:00:00Z"
    }
end note

@enduml
